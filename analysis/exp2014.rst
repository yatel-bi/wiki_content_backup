.. tags: Análisis, 2014, Exploración, Variabilidad
.. title: Exploración de datos 2014

Resumen para Paz
++++++++++++++++

**1) Muestras**

En 2014 se agregaron 65 muestras a la base de datos

**2) Bandas/segmentos**

En los PAGE aparecen 5 bandas que antes no se tenían en cuenta porque no 
existían o porque no sus valores no variaban.

Las nuevas bandas son:

    - B1  	(Para datos antiguos siempre vale 1)
    - B1a 	(Para datos antiguos siempre vale 0)
    - B1b 	(No existía. Para datos antiguos se puso 0)
    - B3c 	(Para datos antiguos siempre vale 0)
    - B7  	(Para datos antiguos siempre vale 1)

**3) Haplotipos**

Hay 12 haplotipos distintos entre las nuevas 65 muestras, 6 de los cuales
nunca habían aparecido, por lo tanto no tenían nombre.

Los nuevos haplotipos son:

.. csv-table:: Nuevos haplotipos
    :header: haplo,B1,B1a,B1b,B3a,B3b,B3c,B5,B7,B8,B9a,B9b,B9c,B10a,B10b,E10,E5

    31,0,0,0,1,0,0,1,1,1,1,0,0,1,1,0,0
    32,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1
    33,1,0,0,0,0,1,1,0,1,1,0,0,1,0,0,1
    34,1,0,0,0,0,1,1,1,1,0,0,1,1,0,0,1
    35,1,0,0,1,0,0,0,1,1,0,0,1,1,0,0,0
    36,1,0,0,1,0,0,1,1,1,1,0,0,1,0,0,1

**3) Análisis de variabilidad con redes de haplotipos**

Esto es lo que publicamos las últimas veces. En los trabajos anteriores la conclusión fue que la variabilidad estaba disminuyendo.
La variabilidad se calcula comparando el indicador SDH con su valor esperado E(SDH).
Cuando se introducen datos nuevos cambian los valores esperados E(SDH).
Los datos históricos se siguen comportando de la misma manera. Los nuevos también, salvo por "2013 - 2014, Endémica", que tiene alta variabilidad.

.. csv-table:: Variabilidad
    :header: Campaña,Región,SDH,E(SDH),Muestras,Alta variabilidad

    1989 - 1990,Endémica,1,2.677122783,3,
    1990 - 1991,Endémica,8,5.315385412,5,X
    1991 - 1992,Endémica,0,2.677122783,3,
    1992 - 1993,Endémica,5,5.315385412,5,
    1992 - 1993,NorEsteEndémica,12,3.972170325,4,X
    1992 - 1993,NorteEndémica,50,10.9602004,9,X
    1993 - 1994,Endémica,4,6.691015658,6,
    1996 - 1997,Endémica,17,12.42291232,10,X
    1996 - 1997,NorteEndémica,4,6.691015658,6,
    1996 - 1997,SurEndémica,3,6.691015658,6,
    1999 - 2000,Endémica,6,15.40065334,12,
    1999 - 2000,Valle de Altura,1,10.9602004,9,
    2000 - 2001,Endémica,1,9.516209467,8,
    2001 - 2002,Endémica,4,21.55318917,16,
    2001 - 2002,NorteEndémica,3,12.42291232,10,
    2002 - 2003,NorteEndémica,8,12.42291232,10,
    2002 - 2003,SurEndémica,4,6.691015658,6,
    2003 - 2004,Endémica,1,13.9032991,11,
    2003 - 2004,NorEsteEndémica,4,6.691015658,6,
    2003 - 2004,NorteEndémica,4,18.44465097,14,
    2003 - 2004,Sur de Núcleo,1,21.55318917,16,
    2003 - 2004,Valle de Altura,15,34.62628718,24,
    2008 - 2009,Endémica,1,18.44465097,14,
    2010 - 2011,Endémica,101,129.690877,72,
    2010 - 2011,Sur de Núcleo,3,32.93681081,23,
    2010 - 2011,SurEndémica,8,31.26295119,22,
    2011 - 2012,Endémica,2,5.315385412,5,
    2011 - 2012,SurEndémica,25,39.78680295,27,
    2013 - 2014,Endémica,111,46.87488743,31,X
    2013 - 2014,SurEndémica,42,52.33837028,34,

Otros datos y cosas útiles
++++++++++++++++++++++++++

Cálculo de la variabilidad (SDH vs E(SDH)) con filtro por año para ver la evolución

.. code-block:: sql

    SELECT 
     campania, 
     region, 
     sdh, 
     SUM(weight*(1-pow((1-Prob_hap_0),cant_muestras))*(1.0-pow((1.0-Prob_hap_1),cant_muestras))) AS Esdh, 
     cant_muestras,
     IF(sdh<SUM(weight*(1-pow((1-Prob_hap_0),cant_muestras))*(1.0-pow((1.0-Prob_hap_1),cant_muestras))),'','X') AS var
    FROM
         (
          SELECT campania, region, sum(weight) as sdh, cant_muestras
          FROM
               (
                SELECT A.campania, A.region, hap_0, hap_1, weight, cant_muestras
                FROM edges,
                     (
                      SELECT DISTINCT campania, region, hap_id
                      FROM facts
                      WHERE year <= 2011
                     ) A,
                     (
                      SELECT DISTINCT campania, region, hap_id
                      FROM facts
                      WHERE year <= 2011
                     ) B,
                     (
                      SELECT campania, region, count(*) as cant_muestras
                      FROM facts
                      WHERE year <= 2011
                      GROUP BY campania, region
                      HAVING cant_muestras > 1
                     ) Cantm
                WHERE A.hap_id <= B.hap_id
                AND   hap_0 = A.hap_id
                AND   hap_1 = B.hap_id
                AND   A.campania = B.campania
                AND   A.region = B.region
                AND   A.campania = Cantm.campania
                AND   A.region = Cantm.region
               ) C
          GROUP BY campania, region, cant_muestras
         ) Q_SDH,
         (
          SELECT hap_0, hap_1, weight, PA.prob_haplo AS prob_hap_0, PB.prob_haplo AS prob_hap_1
          FROM edges,
               (
                SELECT hap_id, count(*)/cant_total AS prob_haplo
                FROM facts,
                     (
                      SELECT count(*) as cant_total
                      FROM facts
                      WHERE year <= 2011
                     ) A
                WHERE year <= 2011
                GROUP BY hap_id, cant_total
               ) PA,
               (
                SELECT hap_id, count(*)/cant_total AS prob_haplo
                FROM facts,
                     (
                      SELECT count(*) as cant_total
                      FROM facts
                      WHERE year <= 2011
                     ) A
                WHERE year <= 2011                  
                GROUP BY hap_id, cant_total
               ) PB
          WHERE edges.hap_0 < edges.hap_1
          AND   edges.hap_0 = PA.hap_id
          AND   edges.hap_1 = PB.hap_id
         ) Q_ESDH
    GROUP BY campania, region, sdh, cant_muestras


Cálculo de la variabilidad (SDH vs E(SDH)) con filtro por año para ver la evolución

.. code-block:: sql

    SELECT 
     campania, 
     region, 
     sdh, 
     SUM(weight*(1-pow((1-Prob_hap_0),cant_muestras))*(1.0-pow((1.0-Prob_hap_1),cant_muestras))) AS Esdh, 
     cant_muestras,
     IF(sdh<SUM(weight*(1-pow((1-Prob_hap_0),cant_muestras))*(1.0-pow((1.0-Prob_hap_1),cant_muestras))),'','X') AS var
    FROM
         (
          SELECT campania, region, sum(weight) as sdh, cant_muestras
          FROM
               (
                SELECT A.campania, A.region, hap_0, hap_1, weight, cant_muestras
                FROM edges,
                     (
                      SELECT DISTINCT campania, region, hap_id
                      FROM facts
                     ) A,
                     (
                      SELECT DISTINCT campania, region, hap_id
                      FROM facts
                     ) B,
                     (
                      SELECT campania, region, count(*) as cant_muestras
                      FROM facts
                      
                      GROUP BY campania, region
                      HAVING cant_muestras > 1
                     ) Cantm
                WHERE A.hap_id <= B.hap_id
                AND   hap_0 = A.hap_id
                AND   hap_1 = B.hap_id
                AND   A.campania = B.campania
                AND   A.region = B.region
                AND   A.campania = Cantm.campania
                AND   A.region = Cantm.region
               ) C
          GROUP BY campania, region, cant_muestras
         ) Q_SDH,
         (
          SELECT hap_0, hap_1, weight, PA.prob_haplo AS prob_hap_0, PB.prob_haplo AS prob_hap_1
          FROM edges,
               (
                SELECT hap_id, count(*)/cant_total AS prob_haplo
                FROM facts,
                     (
                      SELECT count(*) as cant_total
                      FROM facts
                      
                     ) A
                GROUP BY hap_id, cant_total
               ) PA,
               (
                SELECT hap_id, count(*)/cant_total AS prob_haplo
                FROM facts,
                     (
                      SELECT count(*) as cant_total
                      FROM facts
                     ) A
                GROUP BY hap_id, cant_total
               ) PB
          WHERE edges.hap_0 < edges.hap_1
          AND   edges.hap_0 = PA.hap_id
          AND   edges.hap_1 = PB.hap_id
         ) Q_ESDH
    GROUP BY campania, region, sdh, cant_muestras
    
    
